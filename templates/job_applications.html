<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Applications - AI Bid Application System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/app.css" rel="stylesheet">
    <style>
        .status-card {
            transition: all 0.3s ease;
        }
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .opportunity-card {
            border-left: 4px solid #007bff;
        }
        .opportunity-card.high-match {
            border-left-color: #28a745;
        }
        .opportunity-card.medium-match {
            border-left-color: #ffc107;
        }
        .opportunity-card.low-match {
            border-left-color: #dc3545;
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: block;
        }
        .status-card.clickable { cursor: pointer; }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary" role="navigation" aria-label="Primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-robot me-2" aria-hidden="true"></i><span class="visually-hidden">AI</span>AI Bid Application System
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h4><i class="fas fa-briefcase me-2"></i>Job Applications</h4>
                    </div>
                    <div class="card-body">
                        <p class="lead">Browse and manage job opportunities from various sources.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Controls -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-search me-2"></i>Search Jobs</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Days Back</label>
                            <input type="number" class="form-control" id="days-back" value="14" min="1" max="30">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Max Opportunities</label>
                            <input type="number" class="form-control" id="max-opportunities" value="50" min="1" max="200">
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="quick-search" checked>
                            <label class="form-check-label" for="quick-search">
                                Quick Search (limit keyword count)
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="run-parallel" checked>
                            <label class="form-check-label" for="run-parallel">
                                Run scrapers in parallel
                            </label>
                        </div>
                        <button class="btn btn-info w-100" onclick="searchJobOpportunities()">
                            <i class="fas fa-search me-2"></i>Search Jobs
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column - Results -->
            <div class="col-md-8">
                <!-- Job Opportunities List -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-list me-2"></i>Job Opportunities <span id="job-opportunities-count" class="text-muted small ms-2"></span></h5>
                        <div class="d-flex align-items-center gap-2">
                            <div class="input-group input-group-sm" style="width:auto">
                                <span class="input-group-text">Sort</span>
                                <select id="job-sort" class="form-select form-select-sm" onchange="setJobSort(this.value)">
                                    <option value="due_date_asc" selected>Due soon</option>
                                    <option value="title_asc">Title A–Z</option>
                                    <option value="agency_asc">Company/Agency A–Z</option>
                                    <option value="source_asc">Source A–Z</option>
                                </select>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshJobOpportunities()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="job-opportunities-list" class="mt-3" role="status" aria-live="polite"></div>
                            <div class="text-center text-muted">
                                <i class="fas fa-search fa-3x mb-3"></i>
                                <p>Search for job opportunities to see results here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Applications History -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-history me-2"></i>Job Application History</h5>
                    </div>
                    <div class="card-body">
                        <div id="job-applications-history">
                            <div class="text-center text-muted">
                                <i class="fas fa-file-contract fa-3x mb-3"></i>
                                <p>Your job application history will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include the same modals from index.html -->
    <!-- Document Upload Modal -->
    <div class="modal fade" id="documentsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-alt me-2"></i>Company Documents</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="documents-list">
                        <div class="text-center text-muted">
                            <p>Loading documents...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Applications Modal -->
    <div class="modal fade" id="applicationsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-contract me-2"></i>Generated Applications</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="applications-list">
                        <div class="text-center text-muted">
                            <p>Loading applications...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Function to fetch job opportunities
        async function fetchJobOpportunities() {
            try {
                const response = await fetch('/api/opportunities/jobs');
                const data = await response.json();
                displayJobOpportunities(data.opportunities);
            } catch (error) {
                console.error('Error fetching job opportunities:', error);
            }
        }
        
        // Display job opportunities
        function displayJobOpportunities(opportunities) {
            const container = document.getElementById('job-opportunities-list');
            const countEl = document.getElementById('job-opportunities-count');
            if (!container) return;
            if (!opportunities || opportunities.length === 0) {
              container.innerHTML = `
                <div class="text-center text-muted" role="status" aria-live="polite">
                  <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
                  <p>No job opportunities found yet. Use the search controls above.</p>
                </div>`;
              if (countEl) countEl.textContent = '0 results';
              return;
            }
            const sorted = sortJobs(opportunities);
            if (countEl) countEl.textContent = `${sorted.length} results`;
            container.innerHTML = sorted.map(opp => {
              const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
              const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
              const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
              return `
                <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
                  <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
                    <div class="me-3">
                      <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
                      <div class="text-muted small mb-2">
                        <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                        ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
                      </div>
                      ${dueHtml}
                    </div>
                    <div class="mt-3 mt-md-0 d-flex gap-2">
                      <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                         <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
                       </button>
                       ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
                    </div>
                  </div>
                </div>`;
            }).join('');
        }
        
        // Load job opportunities (filtered for job listings only)
        async function searchJobOpportunities() {
            const daysBack = document.getElementById('days-back').value;
            const maxOpportunities = document.getElementById('max-opportunities').value;
            const quickSearch = document.getElementById('quick-search').checked;
            const runParallel = document.getElementById('run-parallel').checked;
            
            const listElement = document.getElementById('job-opportunities-list');
            listElement.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"></div><p class="mt-2">Searching for job opportunities...</p></div>';
            
            try {
                const response = await fetch(`/api/opportunities/jobs?days_back=${daysBack}&max_opportunities=${maxOpportunities}&quick_search=${quickSearch}&run_parallel=${runParallel}`);
                const data = await response.json();
                displayJobOpportunities(data.opportunities);
            } catch (error) {
                console.error('Error fetching job opportunities:', error);
                listElement.innerHTML = '<div class="text-center text-danger"><p>Error loading job opportunities. Please try again.</p></div>';
            }
        }

        function refreshJobOpportunities() {
            searchJobOpportunities();
        }

        // Load job application history
        async function loadJobApplicationHistory() {
            const historyElement = document.getElementById('job-applications-history');
            historyElement.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"></div><p class="mt-2">Loading job application history...</p></div>';
            
            try {
                const response = await fetch('/api/history/applications/jobs');
                const data = await response.json();
                
                if (data.applications && data.applications.length > 0) {
                    historyElement.innerHTML = '';
                    data.applications.forEach(app => {
                        const card = document.createElement('div');
                        card.className = 'card mb-3';
                        card.innerHTML = `
                            <div class="card-body">
                                <h5 class="card-title">${app.opportunity_title || 'Untitled'}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${app.opportunity_agency || 'Unknown'}</h6>
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="fas fa-calendar-alt me-1"></i>${app.generated_date ? new Date(app.generated_date).toLocaleDateString() : 'Unknown date'}
                                    </small>
                                </p>
                                <div class="d-flex justify-content-between">
                                    <a href="/applications/${app.folder}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-file-alt me-1"></i>View Application
                                    </a>
                                    <button class="btn btn-sm btn-info" onclick="emailApplication('${app.opportunity_id}')">
                                        <i class="fas fa-envelope me-1"></i>Email
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteApplication('${app.folder}', this)">
                                        <i class="fas fa-trash-alt" aria-label="Delete" title="Delete"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        historyElement.appendChild(card);
                    });
                } else {
                    historyElement.innerHTML = '<div class="text-center text-muted"><p>No job applications found.</p></div>';
                }
            } catch (error) {
                console.error('Error fetching job application history:', error);
                historyElement.innerHTML = '<div class="text-center text-danger"><p>Error loading job application history. Please try again.</p></div>';
            }
        }

        // Generate application
        async function generateApplication(opportunityId) {
            // Reuse the same function from index.html
            // This would typically be in a shared JS file
            alert('Generating application for opportunity: ' + opportunityId);
            // Implementation would be similar to the main page
        }

        // Email application
        async function emailApplication(opportunityId) {
            // Reuse the same UI/flow as index.html
            const docs = await (await fetch('/api/documents')).json();
            const docNames = (docs.documents || []).map(d => d.name);

            const selectionHtml = `
                <div class="modal fade" id="emailDocsModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fas fa-paperclip me-2"></i>Select attachments</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-2 small text-muted">WIC documents are preselected by keyword automatically ("wic") unless you choose "Only send selected" below.</div>
                                <div id="email-docs-list" class="d-flex flex-column gap-1" style="max-height:260px;overflow:auto;"></div>
                                <div class="mt-2">
                                    <label class="form-label small">Extra keyword filters (comma-separated)</label>
                                    <input id="email-extra-keywords" class="form-control form-control-sm" placeholder="e.g. wic, company profile" value="wic">
                                </div>
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="email-selected-only">
                                    <label class="form-check-label small" for="email-selected-only">
                                        Only send the files I select (don’t auto-attach suggested docs)
                                    </label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button id="email-send-btn" type="button" class="btn btn-success">Send Email</button>
                            </div>
                        </div>
                    </div>
                </div>`;

            let modalWrapper = document.getElementById('emailDocsModal');
            if (!modalWrapper) {
                const div = document.createElement('div');
                div.innerHTML = selectionHtml;
                document.body.appendChild(div.firstElementChild);
                modalWrapper = document.getElementById('emailDocsModal');
            }

            const listEl = modalWrapper.querySelector('#email-docs-list');
            listEl.innerHTML = (docNames.length ? docNames.map(n => `
                <label class="form-check small">
                    <input class="form-check-input" type="checkbox" value="${n}">
                    <span class="form-check-label">${n}</span>
                </label>
            `).join('') : '<div class="text-muted small">No documents found. Upload from the Documents section.</div>');

            const bsModal = new bootstrap.Modal(modalWrapper);
            bsModal.show();

            const sendBtn = modalWrapper.querySelector('#email-send-btn');
            sendBtn.onclick = async () => {
                const checked = Array.from(listEl.querySelectorAll('input[type="checkbox"]:checked')).map(i => i.value);
                const kwInput = modalWrapper.querySelector('#email-extra-keywords');
                const extraKeywords = kwInput.value.split(',').map(s => s.trim()).filter(Boolean);
                const selectedOnly = modalWrapper.querySelector('#email-selected-only').checked;

                bsModal.hide();
                showLoading('Sending email...');
                try {
                    const response = await fetch('/api/applications/email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            opportunity_id: opportunityId,
                            extra_doc_names: checked,
                            extra_doc_keywords: extraKeywords,
                            selected_only: selectedOnly
                        })
                    });
                    const result = await response.json();
                    if (result.status === 'success') {
                        showToast('Email sent successfully', 'success');
                    } else {
                        showToast(result.message || 'Failed to send email', 'error');
                    }
                } catch (err) {
                    console.error('Email error:', err);
                    showToast('Email failed: ' + err.message, 'error');
                } finally {
                    hideLoading();
                    loadJobApplicationHistory();
                }
            };
        }

        // Document modal functions
        function openDocumentsModal() {
            const modal = new bootstrap.Modal(document.getElementById('documentsModal'));
            modal.show();
            // Load documents list
        }

        // Applications modal functions
        function openApplicationsModal() {
            const modal = new bootstrap.Modal(document.getElementById('applicationsModal'));
            modal.show();
            // Load applications list
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load job opportunities and history on page load
            searchJobOpportunities();
            loadJobApplicationHistory();
        });
    </script>
</body>
</html>

<script>
function hideToast() {
    const toast = document.getElementById('toast');
    if (!toast) return;
    try {
        const bsToast = bootstrap.Toast.getInstance(toast) || new bootstrap.Toast(toast);
        bsToast.hide();
    } catch (e) {
        toast.classList.remove('show');
    }
}
async function deleteApplication(folder, btn) {
    let removed = null;
    try {
        // Optimistically remove the card
        if (btn && btn.closest) {
            const card = btn.closest('.card, .border.rounded, .d-flex');
            if (card && card.parentNode) {
                removed = { parent: card.parentNode, el: card, next: card.nextSibling };
                card.remove();
            }
        }

        const res = await fetch(`/api/applications/${encodeURIComponent(folder)}`, { method: 'DELETE' });
        let data = {};
        try { data = await res.json(); } catch (e) {}
        if (!res.ok) throw new Error(data.detail || data.message || 'Failed to delete');
        // Clear any lingering error toasts
        try { hideToast(); } catch (e) {}
        showToast('Application deleted', 'success');
        loadJobApplicationHistory();
    } catch (err) {
        console.error('Failed to delete application', err);
        showToast('Failed to delete application', 'error');
        // Restore element if deletion failed
        if (removed && removed.parent) {
            removed.parent.insertBefore(removed.el, removed.next);
        }
    }
}
</script>

<script>
// Generate application (Bid / Apply)
async function generateApplication(opportunityId) {
    try { if (typeof showLoading === 'function') showLoading('Generating application...'); } catch (_) {}
    try {
        const response = await fetch('/api/applications/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ opportunity_id: opportunityId, background: false })
        });
        const result = await response.json();
        if (result.status === 'success') {
            try { if (typeof hideLoading === 'function') hideLoading(); } catch (_) {}
            try { if (typeof showToast === 'function') showToast(result.message || 'Application generated', 'success'); } catch (_) { alert(result.message || 'Application generated'); }
            // Refresh history without blocking UI
            setTimeout(() => { try { loadJobApplicationHistory(); } catch (_) {} }, 0);
        } else {
            try { if (typeof hideLoading === 'function') hideLoading(); } catch (_) {}
            try { if (typeof showToast === 'function') showToast(result.message || 'Generation failed', 'error'); } catch (_) { alert(result.message || 'Generation failed'); }
        }
    } catch (e) {
        try { if (typeof hideLoading === 'function') hideLoading(); } catch (_) {}
        try { if (typeof showToast === 'function') showToast('Generation failed: ' + e.message, 'error'); } catch (_) { alert('Generation failed: ' + e.message); }
    }
}
</script>

let jobCurrentSort = 'due_date_asc';
function setJobSort(v){ jobCurrentSort = v; refreshJobOpportunities(); }
function jobDaysLeft(dateStr){ try{ const d=new Date(dateStr); const now=new Date(); return Math.ceil((d-now)/(1000*60*60*24)); }catch(_){ return null; } }
function jobDueBadge(dateStr){ const d=jobDaysLeft(dateStr); if(d===null||isNaN(d)) return ''; if(d<0) return '<span class="badge bg-danger ms-2">Expired</span>'; if(d<=3) return `<span class=\"badge bg-danger ms-2\">${d}d</span>`; if(d<=7) return `<span class=\"badge bg-warning text-dark ms-2\">${d}d</span>`; return `<span class=\"badge bg-secondary ms-2\">${d}d</span>`; }
function sortJobs(list){ const key=jobCurrentSort||'due_date_asc'; const byText=(a,b,p)=>((a[p]||'').toString().localeCompare((b[p]||'').toString(),undefined,{sensitivity:'base'})); const byDate=(a,b)=>{ const da=a.due_date?new Date(a.due_date).getTime():Infinity; const db=b.due_date?new Date(b.due_date).getTime():Infinity; return da-db; }; const arr=list.slice(); if(key==='title_asc') return arr.sort((a,b)=>byText(a,b,'title')); if(key==='agency_asc') return arr.sort((a,b)=>byText(a,b,'agency')); if(key==='source_asc') return arr.sort((a,b)=>byText(a,b,'source')); return arr.sort(byDate); }
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge = '<span class="badge bg-info text-dark ms-2">Job</span>';
      const remoteBadge = opp.is_remote ? '<span class="badge bg-success ms-2">Remote</span>' : '';
      const dueHtml = opp.due_date ? `<div class=\"text-muted small\"><i class=\"fas fa-calendar-alt me-1\" aria-hidden=\"true\"></i>Expires: ${new Date(opp.due_date).toLocaleDateString()} ${jobDueBadge(opp.due_date)}</div>` : '';
      return `
        <div class="card mb-3 opportunity-card ${opp.is_remote ? 'border-success' : ''}">
          <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start">
            <div class="me-3">
              <h5 class="card-title mb-1">${opp.title || 'Untitled'} ${typeBadge} ${remoteBadge}</h5>
              <div class="text-muted small mb-2">
                <i class="fas fa-building me-1" aria-hidden="true"></i>${opp.company || opp.agency || 'Unknown'}
                ${opp.location ? `<span class=\"mx-2\">•</span><i class=\"fas fa-map-marker-alt me-1\" aria-hidden=\"true\"></i>${opp.location}` : ''}
              </div>
              ${dueHtml}
            </div>
            <div class="mt-3 mt-md-0 d-flex gap-2">
              <button class="btn btn-sm btn-primary" onclick="generateApplication('${opp.opportunity_id}')">
                 <i class="fas fa-file-contract me-1" aria-hidden="true"></i>Generate Application
               </button>
               ${opp.url ? `<a class="btn btn-sm btn-outline-secondary" href="${opp.url}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt me-1" aria-hidden="true"></i>Details</a>` : ''}
            </div>
          </div>
        </div>`;
    }).join('');
}
function displayJobOpportunities(opportunities) {
    const container = document.getElementById('job-opportunities-list');
    const countEl = document.getElementById('job-opportunities-count');
    if (!container) return;
    if (!opportunities || opportunities.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" role="status" aria-live="polite">
          <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
          <p>No job opportunities found yet. Use the search controls above.</p>
        </div>`;
      if (countEl) countEl.textContent = '0 results';
      return;
    }
    const sorted = sortJobs(opportunities);
    if (countEl) countEl.textContent = `${sorted.length} results`;
    container.innerHTML = sorted.map(opp => {
      const typeBadge